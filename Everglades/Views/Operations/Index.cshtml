@model Everglades.Models.ModelManage

@{
    Layout = null;
    ViewBag.Title = "Operations";
    string input;
    using (var reader = new StreamReader(Request.InputStream))
    {
        input = reader.ReadToEnd();
    }
    string msg = "";
}

@{
    if (Request.Form.Count > 0)
    {
        if (String.Compare(Request["operation"], "buy") == 0)
        {
            string name = Request["asset"];
            Everglades.Models.IAsset asset = Model.Assets.Find(x => String.Compare(x.Get_Name(), name) == 0);
            if (asset == null)
            {
                msg = "cannot find asset";
            }
            else
            {
                try {
                    Model.buy(asset, Int32.Parse(Request["number"]));
                    msg = "bought " + Request["number"] + " of " + Request["asset"];
                }
                catch(ArgumentOutOfRangeException e)
                {
                    msg = e.ParamName;
                }
            }
        }
        else if (String.Compare(Request["operation"], "sell") == 0)
        {
            string name = Request["asset"];
            Everglades.Models.IAsset asset = Model.Assets.Find(x => String.Compare(x.Get_Name(), name) == 0);
            if (asset == null)
            {
                msg = "cannot find asset";
            }
            else
            {
                Model.sell(asset, Int32.Parse(Request["number"]));
                msg = "sold " + Request["number"] + " of " + Request["asset"];
            }
        }
    }
}

@msg
